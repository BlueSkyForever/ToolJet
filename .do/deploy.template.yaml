spec:
  name: tooljet
  services:
  - name: tooljet
    image:
      registry_type: DOCKER_HUB
      registry: tooljet
      repository: tooljet-te-ce
      tag: latest
    run_command: "./server/scripts/digitalocean-postbuild.sh"
    instance_size_slug: "basic-s"
    health_check:
      initial_delay_seconds: 10
      http_path: /api/health
    envs:
    - key: NODE_ENV
      value: "production"
    - key: NODE_OPTIONS
      value: "--max-old-space-size=4096"
    - key: LOCKBOX_MASTER_KEY
      type: SECRET
      value: "REPLACE_ME"
    - key: SECRET_KEY_BASE
      value: "REPLACE_ME"
      type: SECRET
    - key: PGRST_JWT_SECRET
      value: "r9iMKoe5CRMgvJBBtp4HrqN7QiPpUToj"
      type: SECRET
    - key: ENABLE_TOOLJET_DB
      value: "true"
      scope: RUN_TIME
    - key: TOOLJET_DB
      value: ${pg-db.DATABASE}
      scope: RUN_TIME
    - key: PGRST_HOST
      value: ${_self.PUBLIC_URL}/tooljetdb
      scope: RUN_TIME
    - key: DISABLE_SIGNUPS
      value: "false"
      scope: RUN_TIME
    - key: DISABLE_MULTI_WORKSPACE
      value: "false"
      scope: RUN_TIME
    - key: DEPLOYMENT_PLATFORM
      value: "digitalocean"
    - key: DATABASE_URL
      scope: RUN_TIME
      value: ${pg-db.DATABASE_URL}
    - key: CA_CERT
      scope: RUN_TIME
      value: ${pg-db.CA_CERT}
    - key: TOOLJET_HOST
      scope: RUN_TIME
      value: ${APP_URL}
    - key: TOOLJET_SERVER_URL
      scope: RUN_TIME
      value: ${APP_URL}
  - name: postgrest
    image:
      registry_type: DOCKER_HUB
      registry: postgrest
      repository: postgrest
      tag: v10.1.1.20221215
    instance_size_slug: "basic-s"
    http_port: 3000
    health_check:
      initial_delay_seconds: 10
      http_path: /live
      port: 3001
    routes:
      - path: /tooljetdb
    envs:
    - key: PGRST_DB_URI
      scope: RUN_TIME
      value: ${pg-db.DATABASE_URL}
    - key: PGRST_JWT_SECRET
      value: "r9iMKoe5CRMgvJBBtp4HrqN7QiPpUToj"
      type: SECRET
    - key: PGRST_LOG_LEVEL
      value: "info"
    - key: PGRST_ADMIN_SERVER_PORT
      value: "3001"

  databases:
    - name: pg-db
      engine: PG
      production: false
